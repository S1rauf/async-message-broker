–í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã–π –±—ç–∫–µ–Ω–¥ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (Avito) —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–º (Telegram).
–†–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ "–µ–¥–∏–Ω–æ–µ –æ–∫–Ω–æ" —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º—É–ª—å—Ç–∏–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.

**–¢–∏–ø —Å–∏—Å—Ç–µ–º—ã:** Event-Driven Architecture (EDA) –Ω–∞ –±–∞–∑–µ Redis Streams.

![FastAPI](https://img.shields.io/badge/FastAPI-High_Performance-009688?logo=fastapi)
![Redis](https://img.shields.io/badge/Redis-Streams_%26_Cache-red?logo=redis)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-SQLAlchemy-336791?logo=postgresql)
![Docker](https://img.shields.io/badge/Docker-Supervisor-blue?logo=docker)

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Workers), –∫–æ—Ç–æ—Ä—ã–µ –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —à–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö (Redis Streams). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–π –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

1.  **API Gateway (FastAPI):**
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ –æ—Ç Avito.
    *   –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∏ HMAC-SHA256 –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
    *   –ü—É–±–ª–∏–∫—É–µ—Ç "—Å—ã—Ä—ã–µ" —Å–æ–±—ã—Ç–∏—è –≤ `stream:avito:raw_webhooks`.
    *   –û–±—Å–ª—É–∂–∏–≤–∞–µ—Ç WebApp (–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è).

2.  **Ingestor Worker:**
    *   –†–∞–∑–±–∏—Ä–∞–µ—Ç —Å—ã—Ä—ã–µ –≤–µ–±—Ö—É–∫–∏.
    *   –î–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è (Idempotency check —á–µ—Ä–µ–∑ Redis).
    *   –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ –Ω—É–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (`incoming`, `echo`, `system`).

3.  **Processing Worker (Consumer Groups):**
    *   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (–ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤).
    *   –§–æ—Ä–º–∏—Ä—É–µ—Ç ViewModel –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ "–∫–∞—Ä—Ç–æ—á–∫–∏ —á–∞—Ç–∞" –≤ Telegram.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Redis Consumer Groups** –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (ACK) –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

4.  **Sender Worker:**
    *   –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram API.
    *   –†–µ–∞–ª–∏–∑—É–µ—Ç Rate Limiting (—Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API) –∏ –º–µ—Ö–∞–Ω–∏–∑–º Retries –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏.

## üíæ –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ—Ç–æ–∫–æ–≤ (Redis Streams)

*   `avito:incoming:messages` ‚Äî –ü–æ—Ç–æ–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤.
*   `avito:outgoing:messages` ‚Äî –û—á–µ—Ä–µ–¥—å –∏—Å—Ö–æ–¥—è—â–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤.
*   `telegram:chat:actions` ‚Äî –û—á–µ—Ä–µ–¥—å –¥–µ–π—Å—Ç–≤–∏–π (mark_read, typing).

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

*   **Supervisor:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–∑–∞–ø—É—Å–∫ FastAPI –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Python-–≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ).
*   **Security:**
    *   –í—Å–µ —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (Fernet/AES).
    *   –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ X-Signature.
*   **Database:** PostgreSQL + SQLAlchemy (Async) + Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π.
*   **Frontend:** Telegram WebApp (SPA), —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ Vanilla JS (–±–µ–∑ —Ç—è–∂–µ–ª—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤) –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ API
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # –Ø–¥—Ä–æ (Config, DB, Redis, Security)
‚îÇ   ‚îú‚îÄ‚îÄ db_models.py            # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ workers/                # –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ modules/
‚îÇ       ‚îú‚îÄ‚îÄ avito/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ webhook.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Ö—É–∫–æ–≤
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ worker.py       # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ telegram/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ bot.py          # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ view_renderer.py # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UI –∫–∞—Ä—Ç–æ—á–µ–∫ —á–∞—Ç–∞
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ supervisord.conf            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å-–º–µ–Ω–µ–¥–∂–µ—Ä–∞
‚îî‚îÄ‚îÄ docker-compose.yml
